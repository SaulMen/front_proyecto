<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UHospital</title>
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/icons.css">
    <link rel="stylesheet" href="css/responsee.css">
    <link rel="stylesheet" href="owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="owl-carousel/owl.theme.css">
    <!-- CUSTOM STYLE -->
    <link rel="stylesheet" href="css/template-style.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>    
    <script type="text/javascript" src="js/validation.js"></script> 
  </head>  
  
  <body class="size-1140" onload="obtener_var()">
    <!-- HEADER -->
    <header role="banner">    
      <!-- Top Bar -->
      <div class="top-bar background-white">
        <div class="line">
          <div class="s-12 m-6 l-6">
            <div class="top-bar-contact">
              <p class="text-size-12">Contáctenos: +502 0000 0000 | <a class="text-orange-hover" href="index.html">contacto@uhospital.com</a></p>
              <button onclick="cerrar_sesion()">Cerrar sesión</button>
            </div>
          </div>
          <div class="s-12 m-6 l-6">
            <div class="right">
              <ul class="top-bar-social right">
                <li><a href="/"><i class="icon-facebook_circle text-orange-hover"></i></a></li>
                <li><a href="/"><i class="icon-twitter_circle text-orange-hover"></i></a> </li>
                <li><a href="/"><i class="icon-google_plus_circle text-orange-hover"></i></a></li>
                <li><a href="/"><i class="icon-instagram_circle text-orange-hover"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Top Navigation -->
      <nav class="background-white background-primary-hightlight">
        <div class="line">
          <div class="s-12 l-2">
            <a href="index.html" class="logo"><h1><center><FONT COLOR="green"><b>UHospital<b></FONT></center></h1></a>
          </div>
          <div class="top-nav s-12 l-10">
            <p class="nav-text"></p>
            <ul class="right chevron">
              <li><a href="modulo-admin.html">Principal</a></li>
              <li><a href="carga.html">Carga</a></li>
              <li><a href="pacientes-admin.html">Pacientes</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    
    <!-- MAIN -->
    <main role="main">
      <!-- Content -->
      <article>
        <header class="section background-primary text-center">
            <h1 class="text-white margin-bottom-0 text-size-50 text-thin text-line-height-1">UHospital - Carga</h1>
          </header>
        <div class="section background-white"> 
          <div class="line">
            <h1><center>Carga pacientes</center></h1>
            <center><input type="file" accept=".csv" id="files1"></center>
            <center><button style="background-color: #13C82E;" id="submit-file1" onclick="lectura_pacientes()">
            Cargar pacientes</button></center>
            
            <br>
            <br>
            <br>

            <h1><center>Carga doctores</center></h1>
            <center><input type="file" accept=".csv" id="files2"></center>
            <center><button style="background-color: #13C82E;" onclick="lectura_doctores()">
              Cargar doctores</button></center>
            <br>
            <br>
            <br>
            
            <h1><center>Carga enfermeras</center></h1>
            <center><input type="file" accept=".csv" id="files3"></center>
            <center><button style="background-color: #13C82E;" onclick="lectura_enfermeras()">
            Cargar enfermeras</button></center>
            <br>
            <br>
            <br>
            
            <h1><center>Carga medicamentos</center></h1>
            <center><input type="file" accept=".csv" id="files4"></center>
            <center><button style="background-color: #13C82E;" onclick="lectura_medicamentos()">
              Cargar medicamentos</button></center>
            <br>
            <br>
            <br>
            <p class="margin-bottom-30">
            </p>
          </div>
        </div> 
      </article>
    </main>
    
    <!--FOOTER -->
    <footer>
      <hr class="break margin-top-bottom-0" style="border-color: rgba(0, 38, 51, 0.80);">
      
      <!-- Bottom Footer -->
      <section class="padding background-dark">
        <div class="line">
          <div class="s-12 l-6">
            <p class="text-size-12">Copyright 2019, Diseñador de página - Saúl Menchú</p>
            <p class="text-size-12">Estudiante de ingeniería en sistemas. Visita nuestro blog para más información.</p>
          </div>
          <div class="s-12 l-6">
            <a class="right text-size-12" href="http://www.myresponsee.com" title="Responsee - lightweight responsive framework">Diseño y código<br> by Saúl Menchú</a>
          </div>
        </div>
      </section>
    </footer>
    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script>
     

    <script>
      function obtener_var(){
        if (sessionStorage.getItem('rol_usuario') != null){

          console.log(sessionStorage.getItem('rol_usuario'))
          
          if (sessionStorage.getItem('rol_usuario') != 1){
            alert("Sin permiso, usted no es administrador")
            window.location.href = "about.html"
          }

        }else{
          alert("No ha inciado sesión")
          window.location.href = "about.html"
        }

      }

      function cerrar_sesion(){
        sessionStorage.removeItem("rol_usuario")
        sessionStorage.removeItem("id_usuario")
        sessionStorage.removeItem("user_name")
        window.location.href = "about.html"
      }

      function lectura_pacientes(){
        let input_arc = document.getElementById("files1");
        let arc = input_arc.files[0]; 

        if (arc){
          const reader = new FileReader();
          reader.addEventListener("load", (event) =>{
            let texto = event.target.result;
            texto = texto.split("\n");
            salto = 0
            comp = texto.length -1;
            texto.forEach(linea => {
              if(salto > 0){
                let usuario = linea.split(",");
                var user_name = usuario[4]; 
                var user_pass = usuario[5];
                var nombre = usuario[0];
                console.log(user_name + " " + user_pass + " " + nombre);
                fetch('http://localhost:5001/usuario_crear',{
                  method: 'POST',
                  headers:{
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    "user_name": user_name,
                    "user_pass": user_pass,
                    "nombre": nombre
                  })
                })
                .then(res => res.json())
                .then(response => {
                  if (response.status == 100){

                    alert("Se cargaron correctamente");

                  }

                  else{
                    alert("Hubo un error");
                  }
                })
                .catch(err => {
                  console.log.err();
                  alert("Error en el server")
                })
                //revision(usuario, 1);
              }
              salto++;
            });
          })
          reader.readAsText(arc, "UTF-8");
          
        }

      }

      function lectura_doctores(){
        let input_arc = document.getElementById("files2");
        let arc = input_arc.files[0]; 

        if (arc){
          const reader = new FileReader();
          reader.addEventListener("load", (event) =>{
            let texto = event.target.result;
            texto = texto.split("\n");
            salto = 0
            comp = texto.length -1;
            texto.forEach(linea => {
              if(salto > 0){
                let doctor = linea.split(",");
                var nombre = doctor[0];
                var apellido = doctor[1];
                var fecha = doctor[2];
                var genero = doctor[3];
                var user_name = doctor[4]; 
                var user_pass = doctor[5];
                var especialidad = doctor[6];
                var tel = doctor[7];
                console.log(doctor);
                fetch('http://localhost:5001/doctor_crear',{
                  method: 'POST',
                  headers:{
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    "nombre": nombre,
                    "apellido": apellido,
                    "fecha": fecha,
                    "genero": genero,
                    "user_name": user_name,
                    "user_pass": user_pass,
                    "especialidad": especialidad,
                    "tel": tel
                  })
                })
                .then(res => res.json())
                .then(response => {
                  if (response.status == 100){
                    console.log("creado correctamente");
                    
                  }else{
                    alert("Hubo un error");
                  }
                  
                })
                .catch(err => {
                  console.log.err();
                  alert("Error en el server")
                })
                //revision(usuario, 1);
              }
              salto++;
            });
          })
          reader.readAsText(arc, "UTF-8");
          
        }

      }

      function lectura_enfermeras(){
        let input_arc = document.getElementById("files3");
        let arc = input_arc.files[0]; 
        
        if (arc){
          const reader = new FileReader();
          reader.addEventListener("load", (event) =>{
            let texto = event.target.result;
            texto = texto.split("\n");
            salto = 0
            comp = texto.length -1;
            texto.forEach(linea => {
              if(salto > 0){
                let enfermera = linea.split(",");
                var nombre = enfermera[0];
                var apellido = enfermera[1];
                var fecha = enfermera[2];
                var genero = enfermera[3];
                var user_name = enfermera[4]; 
                var user_pass = enfermera[5];
                var tel = enfermera[6];
                console.log(enfermera);
                fetch('http://localhost:5001/enfermera_crear',{
                  method: 'POST',
                  headers:{
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    "nombre": nombre,
                    "apellido": apellido,
                    "fecha": fecha,
                    "genero": genero,
                    "user_name": user_name,
                    "user_pass": user_pass,
                    "tel": tel
                  })
                })
                .then(res => res.json())
                .then(response => {
                  if (response.status == 100){
                    console.log("creado correctamente");
                    
                  }else{
                    alert("Hubo un error");
                  }
                  
                })
                .catch(err => {
                  console.log.err();
                  alert("Error en el server")
                })
                //revision(usuario, 1);
              }
              salto++;
            });
          })
          reader.readAsText(arc, "UTF-8");
          
        }

      }

      function lectura_medicamentos(){
        let input_arc = document.getElementById("files4");
        let arc = input_arc.files[0]; 
        
        if (arc){
          const reader = new FileReader();
          reader.addEventListener("load", (event) =>{
            let texto = event.target.result;
            texto = texto.split("\n");
            salto = 0
            comp = texto.length -1;
            texto.forEach(linea => {
              if(salto > 0){
                let medicamento = linea.split(",");
                var nombre = medicamento[0];
                var precio = medicamento[1];
                var descripcion = medicamento[2];
                var cantidad = medicamento[3];
                console.log(medicamento);
                fetch('http://localhost:5001/medicamento_crear',{
                  method: 'POST',
                  headers:{
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    "nombre": nombre,
                    "precio": precio,
                    "descripcion": descripcion,
                    "cantidad": cantidad
                  })
                })
                .then(res => res.json())
                .then(response => {
                  if (response.status == 100){
                    console.log("creado correctamente");
                    
                  }else{
                    alert("Hubo un error");
                  }
                  
                })
                .catch(err => {
                  console.log.err();
                  alert("Error en el server")
                })
                //revision(usuario, 1);
              }
              salto++;
            });
          })
          reader.readAsText(arc, "UTF-8");
          
        }

      }

    </script>
   </body>
</html>